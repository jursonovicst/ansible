FROM ubuntu:jammy

RUN apt update && apt install -y --no-install-recommends python3-pip curl gnupg2 openssh-client git wget && pip3 --version

ARG HTTP_PROXY
ARG HTTPS_PROXY

RUN pip3 install ansible-core ansible-lint ansible-lint-junit molecule pyvmomi jmespath 'netaddr<1.0' lxml && ansible --version && ansible-galaxy --version && molecule --version

RUN groupadd -r ansible -g 1000 && useradd -u 1000 -r -g ansible -m -d /home/ansible -s /sbin/nologin -c "Ansible user" ansible
USER ansible
RUN mkdir ~/.ssh

ARG GALAXY_PUB_KEY_B64
ARG CDN_GALAXY_GPG_KEYRING=~/.ansible/pubring.kbx
ENV CDN_GALAXY_GPG_KEYRING=~/.ansible/pubring.kbx

ARG GALAXY_PUB_KEY_B64=LS0tLS1CRUdJTiBQR1AgUFVCTElDIEtFWSBCTE9DSy0tLS0tCgptUUdOQkdQczJoOEJEQURjK1BUN3JFUWo3ZGEzenAyaFBlQWxtY25vQmdKb2lOb3dLK1FZQm5xY3EyQnN5TWhCCjF6QkYzVERTSmJaVVFlRTVpSUFaUzdhQlBUOGE2YnRhVGgvWTRGYlRSVFNQMXpTbS9ZZlBndkNsd0w0dkFGZTAKOTJ1M295cWpLNVBWcHdJanRvMmlPNUdvVncxbkhSdnVvbklnNFQ4aEVtN05vWm8rZnpwSkxtWlRLVnllRlc3ZwpONTZsRmJockRram16Z242V0FIZmJyak56YU51ellITWVEYUozVTFJak9Mc2lDN3IvUkJ3MHgzRU82VHdIdCswClAyOHZ5d0dCTnlMUlFHbXdLVVJoMTU2V3F3eFRobjhlVlZKQ3lBNXJCdjZVR3NwdkJpdXpLa2hsVXlFTDJhU3QKWTl1VEkweVp5UnNVbURhSlJ3UHI5MzJJOEMxdlhkVmJMY3pBenAwbExKUkxLUnUvTktmcXJtVXFsQ1BrV2tNWApBL2VyQ2lnVWlDdWtXeXRuQjJKNExxc0dDdTdXRmRaSWZJcFBDUjJKTmlrNUhBWUhmVThVWTEzWTRtWGxOMEVECjc4RzVFQjlLbStwMVhNSDRjTWpXUU1XZEtUaHp6SGtSNXBxYTdRODRyZkZuTWlzcndEZ3hrT21yQ0pLRGNWc2wKN3pVUlBaS3dsbm00bkhzQUVRRUFBYlE5UTBST0lFZGhiR0Y0ZVNBb1EwUk9JRU5KUTBRZ1FXNXphV0pzWlNCSApZV3hoZUhrZ2MybG5ibWx1WnlCclpYa3BJRHhuWVd4aGVIbEFZMlJ1UG9rQjFBUVRBUW9BUGhZaEJIZm5KUlpHCjN3QUFvMkVEQjFwRk9nTCtNcTFYQlFKajdOb2ZBaHNEQlFrRHdtY0FCUXNKQ0FjQ0JoVUtDUWdMQWdRV0FnTUIKQWg0QkFoZUFBQW9KRUZwRk9nTCtNcTFYbXJrTC8wU1hrT0xBY3JZYWxvNUhSMndTRVp6MW1rUEZqaXdHR043MAprbXZBKzJzZG9KbDFxd3FJaU0vbVg2V2V5ekkxZ01ZRitFdEtsTmZrMFpaTUFoSnNPeUFVbnZaSHhvZGE3MmZYCnVhWUxjNnVqQ2xxS3BvR3hvSEVWMGx2VWVIcjFkNEtiSm01NHJNbGowK2lKRXJsZkFTMElyL1hUZXVNSWoxaGEKOEpDYXZkUU5rdEVxd3F4TTMzUU5ybEw4Y2c2U2lyVmJ2cy9UMmNkYVErQlFRUUtaMWlOeVNlTjQxQVlIZXZ6WQpMSDY5eVVrMHlLaldWemRFbmp2L1dFdEtrbVNKVWt4aTFaUmhhMnFDSEhpdnJ3K1M2VFE3ZUFycjFlVkdHQ0pYCjhadXRndkc0aVJqVFMzc2VjOEtYbGw3ZmYrNngyZnovY1hYNkJLeklRNms3MGVJUTQxaWd0S1NUWVgxaDFLa1AKeENFRVlGdDNkNzU2L0h4eVJIZDFLd24zYXJNR3BOQk9hajVDdWo4VDRRNjc5eHd1bmg4M2FFNWllb1RQWTI2VgpPa3pQdGo2Q3BTRnRyZ1RhUzhsejI5Z29jSGxFVFk5MEdPdFk3ZGpITjlKcDNnK0NZYWtMNTdUbStWcDN2bk5sCjN3U0kySUZGeW43eVQ5RjFlejhvb1pkRGw4TFlOcmtCalFSajdOb2ZBUXdBcEI0WnNGR09kekh1KzdVVi9UY1IKc2d0eSs2QytJYmpac3VCYzZoOG8vcVZOTHZnK1hWVjIyaURhVUdaQUoxK1FEMzBmMGp4UkEzaktaQisxR2FsUwpmVU9kd3dDNXBHdHhtdCtHYzRNUWFIYTcyN3hQd3d3UkhiM1Jib0t3cUxZbjMvc0V6cFdRU3Ewdms0K09HN21hCmM3RTZQWk1WMVNKekt2YW53KzlJakh1ZjJqQVhYN0ZmT0l1MlZhVnFBdmJCbmJ1TWRQK1lnOStVS2pPY1cvQUwKaG1yajNzb0ZnV3FWdG8zNmgrUGVOSjBaNXB4RGl4dE8yYjgzZlBQMmxkcjJ2WDFUanBMeDlzY0NiTDlWcTA5MApVOEI3SWpldTA5WXEreUlvQjEzMXdONjlDMC9OaEN6M29kOWlPSVludlJ0bVo0QVdibFBtNDdUOHdwRTJRYkd5Cm9qOXljY2h0SWVCR0lHUGhJd3laempDL2VxYXVSWXpqRmZ0cGc1bkY0ZkxFeVcyT1FhYlIxemdoWFRudExoWkwKRm9GMU5OVXpRRkJLZTZqdlpJdXVjTmpxN2VLZjdGSkFzcDhNdEF6NkljaGYvTjJHY1VFRDN0UEwyY2RtRTA0SgpnTGY0bUcycmtLR0NEemZqNUM2ZmxoVGY0RDZvZ0ZXakRlMTZPWnJXd2xMRkFCRUJBQUdKQWJ3RUdBRUtBQ1lXCklRUjM1eVVXUnQ4QUFLTmhBd2RhUlRvQy9qS3RWd1VDWSt6YUh3SWJEQVVKQThKbkFBQUtDUkJhUlRvQy9qS3QKVnpUTkMvd0pBOEt6QTR5Y29vNyswUHljYnZWZnV5V0hQbG5uT1FqdUZiSlh1RE96a25rYjNTSUszVXJjbEJOWgowZ1ZmRFBtNE5ZeVlUNWtuSFA0SGhLWjZ3NXlQekRSV0ZJTEV2YWl3T0hHTk5QTUZ5TjZ0NStRalJ4UjljZEdiCnpWcHN1Z1FxQTNWamhPNTRDMzNpakc0bFpYeklqbnpHd1RJK3FrM2gxV0ZJQ2tIeUJvOFpPVDhZVDArQTlnak4KbEN5cG9hQkhBL3VHMytnQVJpbTQ2T1pkd1FXQlRtRmc5V1p4dVhIVERwaG54dnI4elBlNWZqQWVQNHh0TXZxNwplZ25TSGFVRWdUQXVXL1VrMzYrVys0ckhOcFF3d3dEamNJRGhPUUhGNFNPLzgvRlArN0tjTlF6VXpMOU9WcXovCmNOTXN3U3MvNFgwT2c4aHA1RG5BN3dxR1JSVzA5a2RTcGhaeTVzT3dwVU0vSzk4azBlUE1JZGNZbnprcEM3bEYKWmcyM0RSR2kzZ2RxZmw0ejVsMW5VK0xZWDlseDhsSURzM0JBaVZyZGpaSmZ5aXUwWjg4M2dCVkJaaytrTkJXQwpIV00yQTVXb0EwbWtieFhIT0JMOE9SdFdGUmUyOXZxVkVKcXdpWGJjUzNTaDlFYis1czNMdTltbXFQZStQZFNpCjAyYWFXMXM9Cj10U2w0Ci0tLS0tRU5EIFBHUCBQVUJMSUMgS0VZIEJMT0NLLS0tLS0KCg==
RUN mkdir ~/.ansible && echo $GALAXY_PUB_KEY_B64 |base64 -d |gpg --import --no-default-keyring --keyring $CDN_GALAXY_GPG_KEYRING - && gpg --list-keys --keyring $CDN_GALAXY_GPG_KEYRING
ENV SSL_CERT_DIR=/etc/ssl/certs
ENV PY_COLORS=1
